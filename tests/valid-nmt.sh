#!/bin/sh
# helper valid script for test-train-nmt.sh

test_dir=`dirname $0`
ref=$test_dir/data/nmt-valid.ref.en
util_dir=$test_dir/../utils
moses_decoder=~/msc_proj/tools/mosesdecoder
translations=$1

cat $translations | \
sed -r 's/\@\@ //g' | \
$moses_decoder/scripts/recaser/detruecase.perl | \
$moses_decoder/scripts/tokenizer/detokenizer.perl -l en | \
grep -v '^\(<p>\)\|\(</p>\)$' > tmp.trans.txt   # rm p-tag

grep -v '^\(<p>\)\|\(</p>\)$' $ref > tmp.ref.txt  # rm p-tag

$util_dir/multi-bleu-detok.perl tmp.ref.txt <  tmp.trans.txt | \
cut -f 3 -d ' ' | \
cut -f 1 -d ',' 

rm tmp.trans.txt
rm tmp.ref.txt