#!/bin/sh
script_dir=`dirname $0`
model_dir=$script_dir/models
source $script_dir/vars

bpe_threshold=50

for prefix in train dev en2zh-test zh2en-test; do
    # preprocessing on EN data
    $moses_home/scripts/tokenizer/tokenizer.perl -a -l en < $data_dir/$prefix.en > $data_dir/$prefix.tok.en
    $moses_home/scripts/recaser/truecase.perl -model $model_dir/truecase.model.en < $data_dir/$prefix.tok.en > $data_dir/$prefix.tok.tc.en
    $bpe_home/apply_bpe.py -c $model_dir/bpe.model.en --vocabulary $model_dir/freq.en --vocabulary-threshold $bpe_threshold < $data_dir/$prefix.tok.tc.en > $data_dir/$prefix.bpe.en
    
    # preprocessing on ZH data
    # convert traditional ZH to simplified ZH
    python -m opencc -c t2s < $data_dir/$prefix.zh > $data_dir/$prefix.sim.zh
    python -m jieba -d ' ' < $data_dir/$prefix.sim.zh > $data_dir/$prefix.sim.tok.zh
    $bpe_home/apply_bpe.py -c $model_dir/bpe.model.zh --vocabulary $model_dir/freq.zh --vocabulary-threshold $bpe_threshold < $data_dir/$prefix.sim.tok.zh > $data_dir/$prefix.bpe.zh
done
