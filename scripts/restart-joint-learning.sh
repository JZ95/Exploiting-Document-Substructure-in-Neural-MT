#!/bin/sh
source ./vars
script_dir=`dirname $0`
src_dir=$script_dir/../src
model_dir=$script_dir/models
data_dir=$data_dir/p-tag
exp_name=joint-logits-with-gate

mkdir -p $ckpt_dir/$exp_name

CUDA_VISIBLE_DEVICES=2,3 $src_dir/train.py \
    --mode joint \
    --batch_size 10 \
    --model $ckpt_dir/$exp_name/model \
    --reload $ckpt_dir/joint-new/joint-new-30000 \
    --dictionaries $model_dir/vocab.zh.json $model_dir/vocab.en.json \
    --aux_dictionary $model_dir/cls_2_id.json \
    --datasets $data_dir/corpus.p_tag.zh $data_dir/corpus.p_tag.en \
    --aux_datasets $data_dir/train.text $data_dir/train.label \
    --valid_datasets $data_dir/dev.p_tag.zh $data_dir/dev.p_tag.en \
    --valid_aux_datasets $data_dir/dev.text $data_dir/dev.label \
    --valid_script ./valid-nmt.sh \
    --valid_batch_size 1 \
    --valid_freq 10000 \
    --disp_freq 500 \
    --sample_freq 40000 \
    --save_freq 10000 \
    --embedding_size 500 \
    --maxlen_word 60 \
    --maxlen_sent 20 \
    --word_rnn_enc_transition_depth 2 \
    --word_rnn_state_size 512 \
    --sent_rnn_state_size 256 \
    --sec_repr_size 256 \
    --tie_decoder_embeddings \
    --rnn_layer_normalisation \
    --translation_maxlen 120 \
    --keep_train_set_in_memory
